#!/bin/sh

echo "Ejecutando pruebas del backend..."

# Verificar si existe el directorio del backend
if [ ! -d "nuevaeps-backend" ]; then
    echo "⚠️ Directorio nuevaeps-backend no encontrado. Saltando pruebas."
    exit 0
fi

# Navegar al directorio del backend y ejecutar las pruebas
cd nuevaeps-backend

# Verificar si hay un archivo pom.xml (proyecto Maven)
if [ ! -f "pom.xml" ]; then
    echo "⚠️ No se encontró pom.xml. Saltando pruebas."
    cd ..
    exit 0
fi

# Ejecutar las pruebas de Maven
mvn test -q

# Capturar el código de salida
TEST_RESULT=$?

# Volver al directorio raíz
cd ..

# Si las pruebas fallan, abortar el commit
if [ $TEST_RESULT -ne 0 ]; then
    echo "❌ Las pruebas del backend fallaron. Commit abortado."
    exit 1
fi

echo "✅ Todas las pruebas del backend pasaron correctamente."
exit 0
